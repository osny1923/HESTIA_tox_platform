---
title: "Ecotoxicological HC20-values and their statistical distribution: A nonlinear weighted regression applied to thousands of chemicals"
author: ""
date: ""
output:
  bookdown::word_document2:
    number_sections: yes
    global_numbering: true
  bookdown::html_document2:
    number_sections: no
    includes:
      in_header: my_styles.css
always_allow_html: yes
bibliography: references.bib
csl: Chemosphere.csl
---
```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(tidy = TRUE, message = F, warning = F, echo = F, tab.topcaption = F)
# These libraries are used for analysis
  #install.packages("bookdown")    
  #install.packages("flextable")    
  #install.packages("ggforce")
  library(rmarkdown)
  library(bookdown)
  library(flextable)
  library(tidyverse)
  library(webchem)
  library(taxize)
  library(kableExtra)
  library(gridExtra)
  #library(htmltools)
  #library(htmlwidgets)
  library(ggforce)

```



```{r dataLoading}
# Load the final database
HESTIA_BASE_dat <- read.csv("results/FINAL_HESTIA.csv")

# Load the cas_smiles list for summaries of original hestia data inventory size
cas_smiles <- read.csv("data/excel_references/Full_CAS_SMILES.csv")

# Physchem wrangle function
source("code/Physchem_read_wrangle_function.R")

# Processing and wrangling the raw data through function loaded above
Physchem_HESTIA <- Physchem_read_wrangle_function(read.csv("data/QSAR_Toolbox_physchem_data_2023-07-11_RAW.csv", header = T, sep = "\t", na.strings = "", fileEncoding = "UTF-16LE",  stringsAsFactors = FALSE))

# Loading the slim version of the Pesticide annotations data for substance use properties and merge this here.
HESTIA_chem_list_slim <- read.csv("results/HESTIA_chem_list_slim.csv")

HESTIA_chem_prop_list_full <- read.csv("results/HESTIA_chem_prop_list_full.csv")

FULL_PHYSCHEM <- left_join(
  x = Physchem_HESTIA, 
  y = HESTIA_chem_list_slim, 
  by = "CAS.Number"
) %>% 
  select(CAS.Number, CanonicalSMILES, PesticideAI_name, 2:31)

HESTIA_HC20_dataset <- read.csv("results/HESTIA_HC20_dataset.csv")

source("code/HC50_calculation_function.R")

# Attaching the Physchem data to HESTIA dataset and outputting a df with HC50 data
HESTIA_HC50_calc <- HC50_calc_function(HESTIA_BASE_dat %>% left_join(x = ., y = FULL_PHYSCHEM, by = "CAS.Number"))

nls_output_df <- read.csv("results/nls_output_df.csv")

RawToxData <- read.csv("data/RAW_DB/HESTIA_HC20_DB_raw_toxdata.csv")
```

```{r taxonomyDiscussion}
# Taxonomy discussion
Species_list <- RawToxData %>% 
    distinct(Test.organisms..species.) 

# Separating the Species_list into columns with binomial species names, and "non-binomial" annotations    
main_taxa_df <- Species_list %>% 
  separate(col = Test.organisms..species., into = "species", sep = " sp\\.| ssp\\.| var\\.| x ", remove = F, convert = F) %>% 
  mutate(non_binom = case_when(!grepl("\\s", species) ~ species),
         species = case_when(!grepl("\\s", species) ~ as.character(NA), TRUE ~ species))

sp_count_tbl <- HESTIA_BASE_dat %>% 
  count(Species, sort = T)

tot_recs <- nrow(RawToxData)
tot_chems <- nrow(RawToxData %>% distinct(CAS.Number))

eff_crit_recs <- nrow(RawToxData %>% 
filter(Effect %in% c(
  "Behavior", "Growth", "Intoxication", "Population", "Reproduction", 
  "Acute", "Cell(s)", "Growth Rate", "Mortality", "Feeding Behavior",
  "Biomass", "Body Weight", "Chronic", "Frond Number", "Development", 
  "Mobility","Seedling Emergence", "Immobilisation", "Behaviour" 
  ) ))
total_data_filtered_out <- tot_recs - nrow(HESTIA_BASE_dat)

# NUmber formatting with thousands-separator
formNnum <- function(x) {
  prettyNum(x, big.mark = ",")
}

```

Oskar Nyberg$^{1,\dagger}$, Reinout Heijungs$^{2,3}$, Patrik Henriksson$^{4,5,6}$

\vspace{20mm}
${^1}$ Department of Ecology, Environment and Plant Sciences, Stockholm University, Svante Arrhenius väg 20A, 104 05, Stockholm, Sweden  
${^2}$ Department of Operations Analytics, Vrije Universiteit, De Boelelaan 1105, 1081 HV, Amsterdam, The Netherlands  
${^3}$ Institute of Environmental Sciences, Leiden University, Van Steenisgebouw Einsteinweg 2, 2333 CC, Leiden, The Netherlands  
${^4}$ Stockholm Resilience Centre, Albanovägen 28, 106 91, Stockholm, Sweden  
${^5}$ WorldFish, Jalan Batu Maung, Batu Maung, 11960 Bayan Lepas, Pulau Pinang, Malaysia  
${^6}$ Beijer Institute of Ecological Economics, The Royal Swedish Academy of Science, Lilla Frescativägen 4 A, Stockholm, Sweden  

${\dagger}$ Corresponding author: [oskar.nyberg@su.se](mailto:oskar.nyberg@su.se); [nyberg.oskar@gmail.com](mailto:nyberg.oskar@gmail.com); [(+46) 735-351260](tel:+46735351260)


**Keywords:**
Ecotoxicological impacts, Probabilistic uncertainty distributions, Species sensitivity distribution, Life cycle impact assessment   


\newpage
# Abstract {-}   
Ecotoxicological effect data which form the basis of evaluations of ecological impacts from chemical emissions are incomplete, and completely absent for some chemicals, which result in risks being overlooked. Where data are available, they tend to be heterogeneous and accompanied with large uncertainties. In the present research we curate ecotoxicological data from openly available sources and present a methodology for quantifying the variability in toxicity for chemicals and evaluate its implications for environmental assessment frameworks, such as life cycle assessments.  

The data collection resulted in a database detailing `r formNnum(nrow(HESTIA_BASE_dat))` curated records that span `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(Species)))` species and `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(CAS.Number)))` chemicals suitable for calculating the concentration response slope factors corresponding to the slope on the SSD curve at the 20% response level of organisms exposed to a chemical ($CRF_{HC20}$). From these data we are able to calculate $CRF_{HC20}$ values and 95% percentile distributions of the $CRF_{HC20}$ for `r formNnum(nrow(HESTIA_HC20_dataset %>% filter(!is.na(HC20EC10eq))))` and `r formNnum(nrow(nls_output_df %>% filter(status %in% c("Convergence", "Convergence; Data insufficient"))))` chemicals respectively. Pesticides is the most data rich category of chemicals, yet has the largest variability attached to the $CRF_{HC20}$.   

We show that the variance among toxicity estimates for the same species and chemical can be used in weighted nonlinear model fitting to generate an uncertainty range attached to a $CRF_{HC20}$ value, allowing for uncertainties related to ecotoxicological impact characterization in environmental frameworks to be estimated. Data scarcity is an omnipresent issue when it comes to characterizing toxicity of chemicals, where only `r round(nrow(HESTIA_HC20_dataset %>% filter(!is.na(HC20EC10eq)))/nrow(HESTIA_HC20_dataset)*100, 1)` % of all chemicals with effect data records have enough data to calculate a $CRF_{HC20}$ value, and `r round(nrow(nls_output_df %>% filter(status %in% c("Convergence", "Convergence; Data insufficient")))/nrow(nls_output_df)*100, 1)` % have enough data to fit a weighted nonlinear least squares model. 
Our recommendation is to incorporate toxicological variance in estimations of ecotoxicity impacts and life cycle impact assessment categories, to reduce ambiguity and allow for verification when comparing ecotoxicological impacts.

\newpage

# Graphical abstract{-}  
  
  \br
  \br
  
```{r graphicalAbstract}
knitr::include_graphics("figures/Graphical Abstract.png")
```
  
Graphical abstract created using BioRender.com
  
\newpage

# Introduction  

Increasing chemical use is a major concern for operating within the safe space of planetary boundaries, and agriculture is a major driving force behind this increase, through pesticide application to commercial crops, veterinarian drugs applied to livestock and farmed aquatic organisms, and disinfectants applied in post-harvest food processing stages [@gordon2017rewiring; @persson2022outside; @simpson2022chlorine]. Chemical use in agriculture is also expected to continue to increase in the coming decade, as a result of larger production volumes and more intensive production systems [@schreinemachers2012]. The agrifood sector is a major emitter of potentially toxic chemicals [@persson2022outside], mainly through the use of pesticides, with an estimated annual use of close to three million metric tonnes [@faoPesticides]. However, data on which potentially toxic chemicals are used for different farming systems, toxicity evaluations for different compounds, and variability in toxicity potentials are incomplete and fragmented, hampering accurate global comparisons of ecotoxicity impacts of different food products [@van2020towards]. While the majority of pesticides emitted are biodegraded, a fraction of pesticides does reach rivers and water catchments where they degrade at slower rates, with potential to bioaccumulate in aquatic organisms [@maggi2023agricultural]. Accurate toxicological characterization of chemicals is essential for ensuring the safety of human health and the environment, where proper toxicological characterization involves the identification and evaluation of the potential adverse effects of chemicals, determining the level of exposure that is safe for humans and the environment, and assessing the risk posed by exposure to chemicals [@krewski2010].

Life cycle assessment (LCA) is increasingly being used as a framework for benchmarking toxicological impacts of agrifood products [@van2020towards]. LCA is an ISO-standardized environmental framework that seeks to aggregate the emissions and resource use throughout a value chain of a product, and characterize these towards one or more environmental impact categories [@international2006environmental]. The results are subsequently scaled to a predefined unit of reference (functional unit), to allow for comparisons between products (e.g. per of kg food), functions (e.g. per kcal), or services (e.g. per washing of a plate). It is most commonly encountered as the methodology behind carbon footprints, but is also used to quantify freshwater consumption, land occupation, eutrophication, biodiversity loss, or toxicity impacts [@hauschild2015]. Toxicity impacts, in turn, are commonly evaluated in terms of human toxicity, either including or excluding cancer cases, and ecotoxicity impacts on freshwater, marine, or terrestrial ecosystems [@hauschild2015].

LCA captures toxicological impacts throughout whole value chains, i.e., mercury emissions from coal-fired power plants to therapeutants used in aquaculture ponds [@bohnes2019life; @malode2023life]. This allow LCAs to provide useful insights into where in value chains the largest toxicity reductions can be achieved, such as that most freshwater ecotoxicological impacts related with prawn farming in Bangladesh are related to the production of certain agricultural materials used for feeds, and not the prawn grow-out [@henriksson2015]. To assess ecotoxicological impacts throughout the value chain of a product, ecotoxicological characterization factors (CF) for chemicals are used to evaluate potential impact of different chemicals in the LCIA phase of an LCA. Toxicological effect data for chemicals provide, together with data on fate and exposure, the basis for CF calculations within LCA. Regrettably, none of the available life cycle impact assessment (LCIA) methodologies provide a complete set of CFs for pesticides and therapeutants, which often leads to neglecting or inserting of a proxy value [@nemecek2022operationalising]. Additionally, ecotoxicological effect data are notoriously heterogeneous since they are reported across hundreds of tested species at variable concentrations, measured effects, and at various empirical or modeled endpoints, resulting in large uncertainty and variability (which we will from here on simply refer to as "uncertainty") in CF calculations.

The evaluation of toxicological impacts in LCA is limited by the number of chemical compounds characterized by impact assessment methodologies. The CF is the value used to translate the amounts of chemicals used to their potential toxicological impacts. There are several different impact assessment methodologies to derive these characterization factors, including USES-LCA v1&2 [@huijbregts2000; @vanZelm2009], IMPACT 2002 [@pennington2005], and UNEP-SETAC’s USEtox [@Fantke_2017], but ultimately, they all rely on similar fundamental data on toxicity and physicochemical properties. Among these impact assessment methodologies, the USEtox model is most widely used at present, and also the one promoted by the European Platform on Life Cycle Assessment (ILCD, 2010).  
The USEtox framework is designed to generate CFs for human toxicological and aquatic ecotoxicity impacts by linking models which estimate environmental distribution and fate of an emitted chemical, ecosystem population exposure to this chemical, and potential toxicological effects to populations being exposed to the chemical [@Fantke_2017]. The present study focuses on the ecotoxicological impacts and the toxicological effect data that are used to generate effect factors (EF) in the latter model. The EF is defined by the the concentration-response slope factor ($CRF_{HC20}$), which corresponds to the slope on a species sensitivity distribution curve (SSD) at the point of the $20^{th}$ percentile response level (HC20) derived from toxicological EC10-equivalent ($EC10^{eq}$) effect data. Each toxicological data point used to construct an SSD curve is an estimated toxicological response of an organism from exposure to a chemical. However, there is variability in the toxicity estimates for every chemical, for the same species. Additionally, depending on the amount of data, which type of chemical, a specific toxic mode of action, and which organisms that are tested will affect the uncertainty of the HC20 value of the SSD curve. When applying the current methodology to derive the HC20 value from an SSD curve, variability in these toxicity data are not accounted for. To investigate the uncertainties attached to $CRF_{HC20}$ values, we propose a method for applying weighted means to species-specific $EC10^{eq}$ averages when constructing SSD curves by applying a non-linear least squares fit model to a cumulative normal distribution of $EC10^{eq}$ data and solve for the mean ($\mu$) and standard deviation ($\sigma$). The estimated $\mu$ and $\sigma$ can subsequently be used in Monte Carlo simulations of a normal distribution of data in the $CRF_{HC20}$ from which a 95% percentile distribution will inform on the probabilistic uncertainty at this data point.  

In order to generate the above mentioned variables, we gathered a large set of ecotoxicological effect data using the OECD QSAR Toolbox [@dimitrov2016qsar] across 16,797 chemicals included in the HESTIA inventory (https://www.hestia.earth). HESTIA a free open-access platform that provides a data repository for life cycle inventory (LCI) data using a harmonized schema and glossary of terms, and provide calculation models for various emissions and impact assessments.

The objectives of this article are to 1) gather freely available ecotoxicological records for chemicals present in the HESTIA inventory and curate these records into a database adapted for EF calculations, 2) calculate $CRF_{HC20}$ values according to recommendations for all chemicals possible within the database, 3) present a methodological approach that can estimate the probabilistic distribution of the $CRF_{HC20}$ value as 95% percentile distribution, and lastly 4) report statistical uncertainty at the $CRF_{HC20}$ value as a geometric standard deviation for as many chemicals possible in the database. 

# Methods  
## Toxicological data collection   
Several databases and software were used to collect data and construct an ecotoxicological database for CRF and uncertainty estimations with detailed descriptions for each step of data collection and curation procedures provided in Appendix A (App. A) along with a schematic diagram of the methodology (Figure A1).
The starting point for ecotoxicological effect data collection is the substance inventory of HESTIA ([http://HESTIA.earth](http://hestia.earth)); a list of 16,797 CAS registry numbers (CASRN) with matching chemical names of potentially harmful substances (App. A 1.1). To ensure the correct identity of chemicals, CASRN and chemical names were matched to Simplified Molecular Input Line Entry System (SMILES) notations by querying the NCBI PubChem database using the R package Webchem [@Webchem_2020] (App. A 1.2). Then, two data queries were made based on the CASRN-SMILES associations to OECD QSAR Toolbox v4.5 [@dimitrov2016qsar] for: a) physicochemical properties required by the USEtox model (App. A 2.1), and b) all openly available aquatic ecotoxicological records accessible through the software (App. A 2.2).  
Next, chemical use-classification information was gathered from USEPA CompTox v2.2 (https://comptox.epa.gov/dashboard/, accessed 2023-01-20), USEPA ECOTOX database (downloaded in its entirety 2022-03-10), The British Compendium of Pesticide Common Names (http://www.bcpcpesticidecompendium.org/, accessed 2022-10-13), The Chemical Entities of Biological Interest (ChEBI) database (https://www.ebi.ac.uk/chebi/init.do; accessed 2023-01-18), The Anatomical Therapeutic Chemical (ATC) Classification System (https://www.whocc.no/). Substance types were then classified into the following chemical groups: `r knitr::combine_words(HESTIA_chem_list_slim %>% distinct(Substance_type) %>% pull(Substance_type))` (App. A 3.1).  
Taxonomic information attached to effect data were updated to the most recent taxonomic classification, common names were converted into Latin names, and spelling errors were corrected (App. A 3.2).  
Data curation was performed according to the following steps (App. A 3.3):  
1) Ecotoxicological effect data were generally reported as a mean effect value at a certain endpoint. Additionally, a substantial amount of data (`r formNnum(nrow(RawToxData %>% filter( !is.na(Value.MinValue))))` records) were reported with a qualifier; "<", ">", =", or "ca.", and in some of these cases records only had effect data reported as a range with a minimum and maximum value (`r formNnum(nrow(RawToxData %>% filter(Qualifier != "No qualifier")))` records). We therefore adjusted test concentrations reported as a range into the lower range value when data were annotated with "ca.", "=" or no annotation;  
2) Records where control type was described as "Insufficient" or "Unsatisfactory" were removed. Additional data based on QSAR estimations or *in vivo* effect based tests were removed in this step by excluding records containing the strings "QSAR", "bioassay", "quantitative" in the title, and the strings "QSAR" and "bioassay" in the experimental design description;  
3) selected freshwater and culture media records only;  
4) selected records with effect criterions relevant for ecological impacts;  
5) removed records missing taxonomic information at the species level;  
6) harmonized effect concentrations and effect concentration units into $mg\text{ }l^{-1}$;  
7) removed records where test duration is <24 h or missing;  
8) acute or chronic definitions were assigned to records based on test duration and taxonomic group; and  
9) effect data from multiple endpoints were combined and converted to $EC10^{eq}$ endpoint according to recommendations [@owsianiak2019]. EC10, EL10, IC10, LC10, LOEC were combined into “EC10”, EC50, EL50, IC50, LC50 were combined into “EC50”, and EC0, LC0, NOAEC, NOEC, NOER, NOEL were combined into “NOEC”. Endpoint conversion using regression coefficients were applied to convert acute EC50, acute NOEC, chronic EC50, and chronic NOEC into chronic $EC10^{eq}$, respectively, using the suggested regression coefficients from [@aurisano_2019]. Admittedly, this will group endpoints that are measured differently, for instance EC0 corresponds to the measured concentration of a chemical at which there is no detectable effect, while NOEC corresponds to the highest measured concentration at which no statistically significant effects are observed compared to a control population.  

## Exploring weighted means of averages and uncertainty through nonlinear least square fit modelling
Based on the assumption of lognormal distribution of ecotoxicological effect data, we investigated the uncertainties of the $CRF_{HC20}$ value by fitting all records per substance to a nonlinear least squares model to explore $\mu$ and $\sigma$ at the 20% response level on the SSD curve. To achieve this, we first defined the raw data. For example, for a specific substance $x$, we have $EC10^{eq}$ data for species $i$, done in a number of experiments, labeled as $k = 1,…,n_i$. The data were thus indicated as $EC10_{i,k}^{eq}$. From here on, we will work with the 10-logarithm of the data, and for conciseness the data are indicated as $L_{(i,k)}$, thus:

\begin{equation}
L_{i,k} = \text{log}_{10}(EC10_{i,k}^{eq}) 
(\#eq:eq1)
\end{equation}

The per-species average over all samples are found as:  

\begin{equation}
M_{i} = \frac{1}{n_{i}}\sum_{k=1}^{n_{i}}L_{i,k}
(\#eq:eq2)
\end{equation}

and the corresponding standard deviation as:

\begin{equation}
S_{i} = \sqrt{\frac{1}{n_{i}-1}\sum_{k=1}^{n_{i}}(L_{i,k}-M_{i})^2}
(\#eq:eq3)
\end{equation}

The average values $M_i$ have a standard error $E_i$ that is given by:

\begin{equation}
E_{i} = \frac{s_{i}}{\sqrt{{n_{i}}}} = \sqrt{\frac{1}{n_{i}(n_{i}-1)}\sum_{k=1}^{n_{i}}(L_{i,k}-M_{i})^2}
(\#eq:eq4)
\end{equation}

Next, we make the assumption that species sensitivity follows a lognormal distribution in agreement with @posthuma_2019. From this distribution of the $M_i$-values, which is characterized by two parameters, the mean ($\mu$) and the standard deviation ($\sigma$), that are traditionally estimated as follows:

\begin{equation}
\hat{\mu} = \frac{1}{m}\sum_{i=1}^{m}M_{i}(\#eq:eq5)
\end{equation}

\begin{equation}
\hat{\sigma} = \sqrt{\frac{1}{(m-1)}\sum_{i=1}^{m}(M_{i}-\hat{\mu})^2}(\#eq:eq6)
\end{equation}

Also, the log$_{10}(HC20_{EC10^{eq}})$ is found as the 20-percentile value of the distribution:

\begin{equation}
\text{log}_{10}(HC20_{EC10^{eq}}) = \hat{\mu} + z_{0.2}\hat{\sigma}
(\#eq:eq7)
\end{equation}

where $z_{0.2}$ is the inverse of the standard normal distribution, which approximates -0.84.  
The $CRF_{HC20}$ value is then derived from the log$_{10}(HC20_{EC10^{eq}})$ by finding the average slope of the SSD curve at the $20^{th}$ percentile response level in Eq.8:

\begin{equation}
CRF_{HC20} = \frac{0.2}{10^{\text{log}(HC20_{EC10^{eq}})}}
(\#eq:eq8)
\end{equation}

We follow @owsianiak_ecotoxicity_2023 and @sala_2022 in defining the CRF-values according to Eq. 8, while emphasizing that this represents an average factor, not a marginal factor as described by @owsianiak_ecotoxicity_2023. We refer to @posthuma2001species for the introduction of marginal factors, to @huijbregts_we_2011 for an argument to switch to marginal factors, and to @heijungs_2021 for pointing out some problems with average factors.  
The uncertainty of this estimate basically depends on two elements: the uncertainty in $\hat\mu$ and the uncertainty in $\hat\sigma$. Both of these depend on the degree of fit with the normal distribution, and with the intra-species variation. Our approach will be to fit a normal distribution to the vector of mean values $M_{i}$, weighted with the reciprocal of the variance, $(1/E_{i}^2)$.
For example, if we fit a function $\text{F}(x;\mu,\sigma)$ to the cumulative distribution of $M_{i}$-values, each of which is associated with a standard error $E_{i}$. We can find the optimal values of $\mu$ and $\sigma$ through a least-squares minimization of the residual:

\begin{equation}
\text{min}\left (\sum_{i=1}^{m}\frac{1}{E_{i}^{2}}(y_{i}-F(m_{i};\mu,\sigma))^{2} \right)
(\#eq:eq9)
\end{equation}

Here, $y_{i}$ denotes the order of appearance in the cumulative form. More precisely:

\begin{equation}
y_{i}=\frac{\text{rank}(M_{i}-0.5)}{m}
(\#eq:eq10)
\end{equation}

For F, we take the cumulative normal distribution, given by:

\begin{equation}
\text{F}(m_{i};\mu,\sigma) = \frac{1}{2}+\frac{1}{2}\text{erf}\left( \frac{x-\mu}{\sigma\sqrt{2}} \right)
(\#eq:eq11)
\end{equation}

To model estimates for $\hat\mu$ and $\hat\sigma$, we fit a weighted nonlinear least-squares (nls) model to the toxicological dose-response data using R-programming language. By assuming a cumulative normal distribution of the data (Eq. 11) and defining a self-starting function for the cumulative normal distribution to start solving for the least squares residual of $\mu$ and $\sigma$. In R we used the 'nls()'-function for this purpose. Starting points, $\mu_{start}$ and $\sigma_{start}$, for the model are defined as:

\begin{equation}
\mu_{start} = \frac{1}{m}\sum_{i=1}^{m}M_{i}
(\#eq:eq12)
\end{equation}
and
\begin{equation}
\sigma_{start} = \frac{1}{m}\sum_{i=1}^{m}S_{i}
(\#eq:eq13)
\end{equation}

respectively. In cases where species-specific effect is based on only one record, variance is unobtainable. Subsequently, since variance is required for weighting, data lacking variance were excluded from calculations, along with data where the variance is 0, which occurs if a species-specific effect is based exclusively on two or more identical values. The calculations are run for all chemicals with effect data (and variance) available for >1 species. If sufficient records were available, the function models the $\hat{\mu}$ (Eq. 5) and $\hat{\sigma}$ (Eq. 6) for each chemical, based on the $M_{i}$ and $S_{i}$ per species. We then calculated the log$_{10}(HC20_{EC10^{eq}})$ using weighted means for each chemical (Eq. 7), as well as extracting the value in the 0.2 quantile of the model results.  

To calculate the variability in the $CRF_{HC20}$, we extracted $\hat{\mu}$ and $E_{i}$ from the model results and fitted the data to a normal distribution using Monte Carlo simulations (100,000 iterations) to populate vectors with simulated $\mu$ and $\sigma$ at the 20% percentile level respectively. These vectors were then used to calculate 100,000 log$_{10}(HC20_{EC10^{eq}})$ values, from which we derived the $CRF_{HC20}$ (Eq. 8). By selecting the 2.5% and 97.5% quantile, the 95% probability distribution of the $CRF_{HC20}$ value could be computed. Since the $CRF_{HC20}$ at this point no longer is expressed on a logarithmic scale, we can compare the magnitude of variability in the $CRF_{HC20}$ across multiple chemicals expressed as the geometric standard deviation, calculated using the "GeoSD" function in the R package EnvStats [@millard2013r]. 

Where SSDs were based on <5 species across <3 taxonomic groups the data were flagged as "Data insufficient", since: 1) the USEtox v2.0 manual requires data from three taxonomic groups; 2) van Zelm et al., [-@van2007uncertainty] points out that uncertainties increase dramatically when the ecotoxicological is calculated using <4 species; and 3) Owsianiak et al., [-@owsianiak2019] points out that at least five species are required for deriving SSDs, to ensure that the HC20 point is not extrapolated below any species' $EC10^{eq}$.

## Data availability in the HESTIA Ecotox Explorer 
Input data and results generated from this article is presented in Appendix B. Additionally, to make the results from this study easily accessible, we have created the an online Ecotox Explorer (*URL being generated*), a repository where users can generate a summary of the model results for each eligible chemical, create dose-response curves for chemicals, view a histogram over the Monte Carlo result's data distribution, and download the underlying ecotoxicological data.  

## Software used
OECD QSAR Toolbox v.4.5 [@dimitrov2016qsar] was used for collecting ecotoxicological data and physicochemical data, `r version$version.string` [@R_team] and was used for data curation, analysis, and visualization, R markdown Pandoc v. `r rmarkdown::pandoc_version()` was used to compile text and data into .docx-format, and Shiny R package version 1.7.4.9002 [@shiny] was used to construct the interactive web-based Ecotox Explorer.  

```{r pkgs}

pkgs <- sessioninfo::package_info(pkgs = "attached", dependencies = FALSE)
pkgtbl <- tibble(
  package = pkgs$package,
  version = pkgs$ondiskversion,
  source = gsub("@", "\\\\@", pkgs$source)
)
pkgtbl_for_suppmat <- flextable(pkgtbl)%>% 
  set_table_properties(layout = "autofit") %>% 
  flextable::fontsize(., size = 9, part = "all")

```

# Results  

```{r Group-summary}
DB_overview <- HESTIA_BASE_dat %>% 
 left_join(
   x = ., 
   y = FULL_PHYSCHEM, 
   by = "CAS.Number") %>% 
 group_by(Group) %>% 
 summarise(
   n_records = n(),
   n_substances = n_distinct(CAS.Number)
 ) %>%
  bind_rows(summarise(
    .,
    across(where(is.numeric), ~sum(., na.rm = T)),
    across(where(is.character), ~as.character("Total") )))
```

## Ecotoxicological database construction  

```{r}
pct_chems <- round(DB_overview[which(DB_overview$Group == "Pesticide"), "n_substances"][1,1]/DB_overview[which(DB_overview$Group == "Total"), "n_substances"]*100, 1)
pct_recs <- round(DB_overview[which(DB_overview$Group == "Pesticide"), "n_records"][1,1]/DB_overview[which(DB_overview$Group == "Total"), "n_records"]*100, 1)
```

Physicochemical properties needed for calculating freshwater aquatic toxicity potentials in USEtox were attained for `r formNnum(nrow(FULL_PHYSCHEM %>% filter(Group != "Unknown")))` chemicals, while ecotoxicological effect data were available for `r formNnum(nrow(RawToxData %>% distinct(CAS.Number)))` chemicals in OECD QSAR Toolbox software. However, after curating the raw data, validated ecotoxicological effect data remain for only `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(CAS.Number)))` chemicals with `r formNnum(nrow(HESTIA_BASE_dat))` records across `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(Species)))` species divided into `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(Taxonomy.Group)))` taxonomic groups (Table A.16). Data availability varies greatly across species, with a few species being over-represented in the dataset, including *`r sp_count_tbl[1,1]`* (`r round((sp_count_tbl[1,2])/nrow(HESTIA_BASE_dat)*100, 0)`%), *`r sp_count_tbl[2,1]`* (`r round((sp_count_tbl[2,2])/nrow(HESTIA_BASE_dat)*100, 0)`%), and *`r sp_count_tbl[3,1]`* (`r round((sp_count_tbl[3,2])/nrow(HESTIA_BASE_dat)*100, 0)`%) that together represent `r round((sum(sp_count_tbl[1:3,2])/nrow(HESTIA_BASE_dat))*100, 0)`% of all data. A detailed outcome of the dataset curation process is presented in Figure A.2.  

Substance use categories are defined as `r knitr::combine_words(DB_overview[1:5,] %>% pull(Group))`, with `r knitr::combine_words(DB_overview[1:5,] %>% pull(n_records))` records, respectively, across `r knitr::combine_words(DB_overview[1:5,] %>% pull(n_substances))` substances, respectively (Table A.15). Pesticides is the most data rich substance use category of these, with `r pct_recs` % of records belong to this category, but only represent `r pct_chems` % of the total number of chemicals in the dataset.  

## Uncertainty estimations
```{r nls-data}
nls_sum <- nls_output_df %>%
  group_by(status) %>%
  summarise(
    n_records = n(),
    min_species_per_substance = min(n_sp),
    max_species_per_substance = max(n_sp),
    min_taxa_per_substance = min(n_tax.grp),
    max_taxa_per_substance = max(n_tax.grp))

noConvergeCounts <- nls_output_df %>% filter(!status %in% c("Convergence", "Convergence; Data insufficient", "Not enough data", "One sigma or fewer")) %>% 
  mutate(enoughData = case_when(n_sigma >= 5 & n_taxa_sigma >= 3 ~ "YES", TRUE ~ "NO")) %>% 
  count(enoughData)


# nls_output_df %>%
#   filter(n_recs >200) %>%
#   arrange(-GStDev)

```

$CRF_{HC20}$ values are attainable for `r formNnum(nrow(HESTIA_HC20_dataset %>% filter(!is.na(HC20))))` chemicals using chronic EC10 equivalents as the underlying effect data according to Eq. 1-8, i.e., the methodology of [@owsianiak_ecotoxicity_2023]. Meanwhile, by fitting a weighted nls model to a cumulative normal distribution of ecotoxicological effect data, data allow for probabilistic uncertainty in the $CRF_{HC20}$ to be calculated for `r formNnum(nrow(nls_output_df %>% filter(status %in% c("Convergence", "Convergence; Data insufficient"))))` chemicals, albeit `r formNnum(nrow(nls_output_df %>% filter(status == "Convergence; Data insufficient")))` of these chemicals are flagged as "Data insufficient", implying that the SSD model has either too few species or taxonomic groups, which generally yield high uncertainties (Figure \@ref(fig:GeoStDev)).  

The dataset contains `r formNnum(nls_sum[grepl("Not enough data", nls_sum$status),2])` chemicals where effect data only are available for one species or one taxonomic group, and can subsequently not run in the model. For another `r formNnum(nls_sum[grepl("One sigma or fewer", nls_sum$status),2])` chemicals, data only include one or fewer species-specific effect value with mean and standard error present. These data are also disqualified and flagged as "One sigma or fewer". The qualification of data for the nls model are summarized in Figure \@ref(fig:modelFlowChart), and highlights that `r formNnum(sum(nls_sum[nls_sum$status %in% c("Convergence", "Fail.Conv; data present", "Fail.Init; data present"),2]))` of the original set of `r formNnum(nrow(cas_smiles %>% distinct(CAS.Number)))` chemicals in the HESTIA data inventory have sufficient data to calculate uncertainty estimates. Model results are reported in Supplementary Data, "NLS_RESULTS"-tab.

```{r modelFlowChart, fig.dim= c(4,5), fig.cap = "Decision tree for data selection and status of model results per chemical. NLS = nonlinear least squares model. n = number of chemicals. Dashed lines imply that results are based on cases with <5 species across <3 taxonomic groups."}
knitr::include_graphics("figures/Fig.1.png")
```

A challenge with the nls model fitting is to define starting parameters for the model that are suitable across the entire dataset. Each chemical data should ideally be evaluated individually with regards to the starting parameters for the nls model, but this is a tedious optimization process and lies outside the scope of this study. For `r nls_sum[5,2]+nls_sum[6,2]` chemicals the model fail to initialize because of sub-optimal starting values, while the model fail to converge for `r nls_sum[3,2]+nls_sum[4,2]` chemicals because the step factor is reduced below the model's automatic cut-off value. This implies that `r round((nls_sum[3,2] + nls_sum[4,2]+nls_sum[5,2]+nls_sum[6,2])/nrow(nls_output_df)*100,1)`% of the chemicals within the dataset failed to produce uncertainty estimates. Moreover, we identify `r noConvergeCounts[grep("YES", noConvergeCounts$enoughData),2]` chemicals that fulfill the data requirements of >5 species across >3 taxonomic groups, but fail to either start or converge, due to effect data spanning several orders of magnitude across both negative and positive log-transformed effect values (data not shown). We tried resolving this issue by adjusting the unit measurement of $EC10^{eq}$ by a factor of $10^6$, i.e., changing the measured concentrations to $ng\text{ }L^{-1}$. This leads to "problematic" concentrations being $>1$ but did not resolve starting or convergence issues. This set of chemicals are seemingly not open for analysis using the choice of starting parameters, or current weighted nls method, for reasons unknown.  

Limited data availability remain the general issue, as only `r round((nrow(nls_output_df %>% filter(status == "Convergence"))/nrow(nls_output_df))*100, 1)`% of all chemicals have enough data to fit the nonlinear least squares model while fulfilling the data requirements of >5 species across >3 taxonomic groups (Figure \@ref(fig:modelFlowChart)). The nls modelling approach allows estimations of uncertainties in the $CRF_{HC20}$ value, but requires a substantial amount of effect data input for the model to run optimally.    

```{r Summary-nls-table, include=FALSE}
flexNLS_sum <- flextable(nls_sum) %>%
set_caption("Summary overview of the nonlinear least square model fit for the HESTIA ecotoxicological database.") %>%
  fontsize(., size = 9, part = "all") %>%
  flextable::set_table_properties(layout = "autofit") %>%
  flextable::set_header_labels(
    status = "Output status",
    n_records = "Number of records",
    min_species_per_substance = "Minimum number of species per chemical",
    max_species_per_substance = "Maximum number of species per chemical",
    min_taxa_per_substance = "Minimum number of taxonomic groups per chemical",
    max_taxa_per_substance = "Maximum number of taxonomic groups per chemical"
  )

```

```{r GeoStDev-tables}
## select only substances with enough data to fit a model to
use_category <- read.csv("results/HESTIA_chem_list_slim.csv")

prob_df <- left_join(
  x = nls_output_df %>% 
    filter(status %in% c("Convergence", "Convergence; Data insufficient")), 
  y = use_category %>% 
    select(CAS.Number, PesticideAI_name, Group, Substance_type), 
  by = "CAS.Number") %>% 
  mutate(sufficient_recs = case_when(
    n_sp < 5 & n_tax.grp <3 ~ "insufficient", 
      TRUE ~ "sufficient")) %>% 
  mutate(Group = case_when(
    Group == "Pesticide" ~ "Pesticides",
    Group == "Antibiotic" ~ "Antibiotics",
    Group == "Pharmaceutical" ~ "Pharmaceuticals",
    Group == "PPCP" ~ "PPCPs",
    TRUE ~ Group 
    ))

top_GeoStDev <- prob_df %>% 
  arrange(-GStDev) %>% 
  filter(status %in% c("Convergence","Convergence; Data insufficient")) %>% 
  select(CAS.Number, PesticideAI_name, Group, GStDev, status) %>% 
  slice(1:50)

```

In order to compare the probability distribution in the $CRF_{HC20}$ value across all chemicals, we calculate the geometric standard deviation for an artificial vector containing 100,000 $CRF_{HC20}$ values generated using Monte Carlo simulations. The geometric standard deviation is decreasing as the number of effect data increases per chemical, and when considering chemicals that fulfill the data requirements of $\ge$ 5 species across $\ge$ 3 taxonomic groups, the highest geometric standard deviation belong to chemicals classified as pesticides, with a range up to `r round(top_GeoStDev[1,4], 1)` (Figure \@ref(fig:GeoStDev)). `r nrow(top_GeoStDev %>% filter(Group == "Pesticides"))` of the top 50 chemicals with highest geometric standard deviation of the probability distribution in the $CRF_{HC20}$ value belongs to pesticides. Chemicals classified into other use categories have far lower geometric standard deviations. 

```{r GeoStDev, fig.dim= c(9,7), fig.cap = "Geometric standard deviation of probability distribution ranges representing 100,000 Monte Carlo simulations for chemicals defined as a) Pesticides, b) Other organic chemicals, c) Antibiotics, d) Other inorganic chemicals, and e) Pharmaceuticals and personal care products (PPCPs). Chemicals with more than 200 effect data records not shown, since geometric standard deviation is <1.4 with 200+ records present. Please note the different scales of the Y-axes. Convergence = the model successfully identified a global minimum sum of squares. Data insufficient = chemicals do not fulfill the data requirements of at least 5 species across a minimum of 3 taxonomic groups."}

source("code/ggplot_fnc.R")
# Create 5 different plots
gl <- list(
plot_pest <- plot_group_uncertainty("Pesticides", prob_df, "a)") +
                scale_y_continuous(breaks = scales::pretty_breaks(n = 7)) +
                facet_grid(GStDev < 8 ~ ., scales = "free_y") +
                theme(strip.background = element_blank(),
                       strip.text = element_blank(),
                      legend.position = "none"),
                
legend_pest <- cowplot::get_legend(plot_group_uncertainty("Pesticides", prob_df, "a)") +
                                     theme(
                                       legend.background = element_blank(),
                                       panel.border = element_rect(colour = "black", fill=NA),
                                       legend.box.background = element_rect(colour = "black")
                                       )),
plot_otherorg <- plot_group_uncertainty("Other organic chemicals", prob_df, "b)"), #+
                  # facet_grid(GStDev < 6 ~., scales = "free_y") + 
                  # theme(strip.background = element_blank(),
                  #    strip.text = element_blank(),
                  #    legend.position = "none") +
                  # scale_y_continuous(breaks = scales::pretty_breaks(n = 6)),
plot_antibiotic <- plot_group_uncertainty("Antibiotics", prob_df, "c)") + scale_y_continuous(breaks = scales::pretty_breaks(n = 4), limits = c(1, 3.5)),
plot_otherinorg <- plot_group_uncertainty("Other inorganic chemicals", prob_df, "d)") + scale_y_continuous(breaks = scales::pretty_breaks(n = 4), limits = c(1, 3.5)),
plot_PPCP <- plot_group_uncertainty("PPCPs", prob_df, "e)") + scale_y_continuous(breaks = scales::pretty_breaks(n = 4), limits = c(1, 3.5))
)
bigplot <- ggpubr::annotate_figure(
  grid.arrange(
    grobs = gl, 
    layout_matrix = rbind(
      c(1,1,2),
      c(1,1,3),
      c(1,1,3),
      c(1,1,3),
      c(4,5,6), 
      c(4,5,6))), 
  left = grid::textGrob("Geometric standard deviation", rot = 90, vjust = 1),
  bottom = grid::textGrob("Number of effect records per chemical"))

bigplot

ggsave("figures/Fig.2.pdf", plot = bigplot, device = "pdf",dpi = 300)

#knitr::include_graphics("figures/fig.3.png")


```

# Discussion  

This study investigated a set of `r formNnum(nrow(cas_smiles %>% distinct(CAS.Number)))` chemicals listed in the HESTIA inventory, which is far from a fully comprehensive database for all potentially harmful agrochemical substances. Of these, ecotoxicological effect data are available for `r formNnum(tot_chems)` chemicals (`r round(100*(tot_chems/nrow(HESTIA_chem_list_slim)), 0)`%). However, after curating the data, only `r formNnum(nrow(HESTIA_BASE_dat %>% distinct(CAS.Number)))` chemicals were deemed to have reliable effect data, of which `r formNnum(nrow(nls_output_df %>% filter(status == "Not enough data")))` chemicals only have one record with reliable effect data. While the ambition of this study is not to gather the most comprehensive ecotoxicity database as possible, it highlight the omnipresent issue of data scarcity in ecotoxicological characterization. Since uncertainty in the $CRF_{HC20}$ decrease as underlying effect data availability increases, we did investigate other potential sources for additional toxicological effect data and found the EnviroTox database [@connors_2019] and the EU environmental footprint v3.1 (EF3.1) database. In October 2022, @sala_2022 published EF3.1 (https://eplca.jrc.ec.europa.eu/ecotox.html) containing $CRF_{HC20}$ values for 6,038 chemicals calculated from toxicological effect data gathered from the ECHA REACH database (European Chemicals Agency, http://echa.europa.eu/). The EF3.1 contains 140 % more characterized chemicals than the USEtox v2.1 organic substance database [@saouter_2019-1; @sala_2022]. However, a substantial part of the toxicological effect data in EF3.1 are marked as proprietary substance registrations within REACH, and cannot be shared (S. Sala, personal communication, 14 Nov 2022). This is unfortunate, since one of the 19 key recommendations of the Ecotoxicity Task Force and the Pellston workshop held in Valencia, Spain in 2018 is to “use data that has a traceable origin” [@owsianiak2019]. Toxicological data contained within the EnviroTox database overlap to a large extent with the data sources of the present database and, after inspection, only >1 % of records (data not shown) in the EnviroTox database could be added without the risk of introducing duplicate data, which prompted us to refrain from including data from this source. 

Finding a good balance in maximizing data inclusion and removing improper toxicological effect records is challenging and case dependent. During data curation we removed `r round((total_data_filtered_out/tot_recs)*100, 1)` % of the original records. The step of removing improper effect criterion descriptions of effect data excluded `r round((tot_recs-eff_crit_recs)/tot_recs*100, 1)` % of the starting dataset (step 4 in Figure \@ref(fig:fig1)). There are surprisingly little guidance available in the literature on this data selection; relevant effect criterions are mentioned only briefly in @saouter_2019-1 and @sala_2022. We also note that for several toxicological effect records, taxonomic details are given at levels above species. When calculating $\hat\mu$, species-specific $EC10^{eq}$ effect values (Eq. 5), records defined at genus level without a species name will influence the calculation by representing an artificial species. For example *Daphnia sp.* will count as one species alongside *D. magna*. Taxonomic identifiers above species-level have been removed from this dataset resulting in the exclusion of `r formNnum(nrow(main_taxa_df %>% filter(!is.na(non_binom))))` taxonomic definitions (not counting common names or erroneous names). However, records defined at genus level are present in the taxonomic records of the EF3.1 with no comment on how these data are treated [@saouter2018environmentalfootprint; @sala_2022]. While data scarcity is an issue, we argue that imposing an artificial data point is an incorrect methodological choice.  

The choice of a weighted nls model also affects what data can be included in uncertainty calculations. Since single-species effect data represented by a single records have no variability, they cannot be used in the weighting of the nls model and are discarded. The minimum data requirements for estimating uncertainty using the present weighted nls method has doubled, from a minimum of 1 to 2 records per species for at least 5 species spanning at least 3 taxonomic groups. To maximize the use of available data, a possible workaround could to assign an arbitrary standard error related to the lower quantile of already present standard errors reported for other species. However, assigning artificial values to data for the sake of uncertainty assessment is a highly ambiguous strategy, and we therefore discourage doing this. In several cases, >2 identical effect data are reported for one species, which yields a standard error of 0. Most of these cases exist due to one study reporting various effects occurring at the same concentrations. These are also removed to not cause an skewed weighing. For environmental assessment frameworks, the paradoxical trade-off consequently becomes that between comprehensive data coverage based on uncertain point value data, or a more limited data coverage based upon data points with associated uncertainty estimates.  

The assembled database contains data at both acute and chronic effect data from EC50, EC10 and NOEC endpoints (and their respective analogues, like LC50, EC0, LOEC etc.), which have been extrapolated using regression coefficients from Aurisano et al. [-@aurisano_2019]. A substantial part of the $EC10^{eq}$ effect data (`r round(nrow(HESTIA_BASE_dat %>% filter(AcuteChronic == "Acute" & Endpoint_conv == "EC50"))/nrow(HESTIA_BASE_dat), 2)*100`%) are extrapolated from Acute EC50 effect data to Chronic EC10eq where large confidence interval ranges are present (e.g., the regression coefficient for fish is estimated to 7.44, with a 95% confidence interval 2.92-18.95; see SI Table 6), and these confidence intervals have not been considered when constructing SSD models. It can be argued that with sufficient numbers of records, a large variation in one of the data points included in the species-specific $EC10^{eq}$ average is negligible. How much this uncertainty influences the final $CRF_{HC20}$ stands to be investigated in future studies.  

The probabilistic distribution of $CRF_{HC20}$ for pesticides seems to be large because of to two reasons: a) the species-specific effect data are highly variable, see figure \@ref(fig:variability)a, Insecticide: Clofentezine where toxic effect span up to four orders of magnitude for species *D. magna*; or b) the effects between target and non-target organisms span large ranges due to the specific toxic mode of action (e.g. insecticides are predominantly toxic for insects; @van2009pesticide; @warren2010application), which is the case for the insecticide "Novaluron" (see figure \@ref(fig:variability)b). With a distribution of effect data at two extremes, we can assume that pesticides will have large uncertainties in the $CRF_{HC20}$ value. Both cases represents pesticides with high geometric standard deviation (`r round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Clofentezine", 4], 2)` and `r round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Novaluron", 4], 2)` respectively), despite fulfilling data requisites of $\ge$ 5 species across $\ge$ 3 taxonomic groups.  

```{r variability, fig.dim = c(5,7), fig.cap="Examples of how a) species-specific effect data is spanning several orders of magnitude, contributing to large uncertainties in the CRF, and b) specific toxic mode of action creates large uncertainty in the CRF. Target organism groups are displaying a response at low concentrations to the insecticide Novaluron, while non-target organism groups show effect at several orders of magnitude higher concentrations. Dots represent individual toxicological records at a converted EC10eq concentration."}

# Terbumeton_plot <- HESTIA_BASE_dat %>%
#   filter(CAS.Number == "33693-04-8") %>%
#   group_by(Species) %>%
#   filter(n() > 1 ) %>% 
#   ungroup() %>% 
#   mutate(Species = str_replace(Species, "(\\w)\\w+\\s(\\w+)", "\\1. \\2")) %>%
#   ggplot(aes(x = reorder(Species, -EC10eq), y = EC10eq, fill = Taxonomy.Group))+
#   geom_point(aes(shape = Taxonomy.Group, color = Taxonomy.Group), size = 2)+
#   scale_y_log10(limits = c(1e-4, 100))+
#   ggtitle("Herbicide: Terbumeton", 
#           subtitle = paste("Geometric standard deviation:", round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Terbumeton", 4], 2), sep = " "))+
#   theme_bw() +
#   theme(axis.title.x = element_blank(),  # Remove x-axis label
#         axis.title.y = element_blank(), # Remove y-axis label
#         axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
#         plot.title = element_text(size = 12),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 8),
#         legend.position = "top")

# IsazophosMethyl_plot <- HESTIA_BASE_dat %>%
#   filter(CAS.Number == "42509-83-1") %>%
#   group_by(Species) %>%
#   filter(n() > 1 ) %>%
#   ungroup() %>%
#   mutate(Species = str_replace(Species, "(\\w)\\w+\\s(\\w+)", "\\1. \\2")) %>%
#   ggplot(aes(x = reorder(Species, -EC10eq), y = EC10eq, fill = Taxonomy.Group))+
#   geom_point(aes(shape = Taxonomy.Group, color = Taxonomy.Group), size = 2)+
#   scale_y_log10(limits = c(1e-4, 100))+
#   ggtitle("Insecticide: Isazophos-methyl",
#           subtitle = paste("Geometric standard deviation:", round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Isazophos-methyl", 4], 2), sep = " "))+
#   theme_bw() +
#   theme(axis.title.x = element_blank(),  # Remove x-axis label
#         axis.title.y = element_blank(), # Remove y-axis label
#         axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
#         plot.title = element_text(size = 12),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 8),
#         legend.position = "top")

Clofentezine_plot <- HESTIA_BASE_dat %>%
  filter(CAS.Number == "74115-24-5") %>%
  mutate(Species = str_replace(Species, "(\\w)\\w+\\s(\\w+)", "\\1. \\2")) %>%
  ggplot(aes(x = reorder(Species, -EC10eq), y = EC10eq, fill = Taxonomy.Group))+
  geom_point(aes(shape = Taxonomy.Group, color = Taxonomy.Group), size = 2)+
  scale_y_log10(limits = c(1e-4, 100))+
  ggtitle("a) Insecticide: Clofentezine", 
          subtitle = paste("Geometric standard deviation:", round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Clofentezine", 4], 2), sep = " "))+
  theme_bw() +
  theme(axis.title.x = element_blank(),  # Remove x-axis label
        axis.title.y = element_blank(), # Remove y-axis label
        axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        plot.title = element_text(size = 12),
        legend.title = element_blank(),
        legend.justification = 0,
        legend.text = element_text(size = 8),
        legend.position = "top")

novaluron_plot <- HESTIA_BASE_dat %>%
  filter(CAS.Number == "116714-46-6") %>%
  mutate(Species = str_replace(Species, "(\\w)\\w+\\s(\\w+)", "\\1. \\2")) %>%
  ggplot(aes(x = reorder(Species, -EC10eq), y = EC10eq, fill = Taxonomy.Group))+
  geom_point(aes(shape = Taxonomy.Group, color = Taxonomy.Group), size = 2)+
  scale_y_log10(limits = c(1e-5, 100))+
  ggtitle("b) Insecticide: Novaluron",
          subtitle = paste("Geometric standard deviation:",round(top_GeoStDev[top_GeoStDev$PesticideAI_name == "Novaluron", 4], 2), sep = " "))+
  theme_bw() +
  theme(axis.title.x = element_blank(),  # Remove x-axis label
        axis.title.y = element_blank(), # Remove y-axis label
        axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        plot.title = element_text(size = 12),
        legend.title = element_blank(),
        legend.justification = 0,
        legend.key.size = unit(3, "mm"),
        legend.text = element_text(size = 8),
        legend.position = "top")

# Pyroxsulam_plot <- HESTIA_BASE_dat %>%
#   filter(CAS.Number == "422556-08-9") %>%
#   mutate(Species = str_replace(Species, "(\\w)\\w+\\s(\\w+)", "\\1. \\2")) %>%
#   ggplot(aes(x = reorder(Species, -EC10eq), y = EC10eq, fill = Taxonomy.Group))+
#   geom_point(aes(shape = Taxonomy.Group, color = Taxonomy.Group), size = 2)+
#   scale_y_log10(limits = c(1e-5, 100)) +
#   ggtitle("Herbicide: Pyroxsulam") +
#   theme_bw() +
#   theme(axis.title.x = element_blank(),  # Remove x-axis label
#         axis.title.y = element_blank(), # Remove y-axis label
#         #axis.ticks.y = element_blank(), # Remove y-axis label
#         axis.text.y = element_blank(), # Remove y-axis label
#         axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
#         plot.title = element_text(size = 12),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 8),
#         legend.position = "top")

twoplot <- ggpubr::annotate_figure(
  grid.arrange(
    grobs = list(Clofentezine_plot, novaluron_plot),
    ncol = 2  # Place plots side by side
  ),
  left = grid::textGrob(expression(EC[10]^eq~(mg~L^-1)~~log[10]-scale), rot = 90, vjust = 1),
  bottom = grid::textGrob(expression(Species))
)

twoplot
ggsave("figures/Fig.3.pdf", plot = twoplot, device = "pdf",dpi = 300)
```

The role of uncertainty when characterizing ecotoxicological impacts from different chemicals depend on the scope of the study. For example, in an LCA detailing hundreds or thousands of chemicals highly uncertain parameters may be masked among the many potentially toxic emissions. Large uncertainty around the toxicity of one chemical may, in the meantime, dominate the overall uncertainty related to ecotoxicity impacts in an Environmental Risk Assessment. In order to quantify overall uncertainties, one therefore needs to assure that most toxicity potentials are accompied by uncertainty estimates, and that all of the most widely used and most toxic compounds have uncertainty parameters. In cases where uncertainty parameters are missing, but new data might have become available, the method proposed above using nonlinear least squares and estimating the probabilistic ranges in the $CRF_{HC20}$ can be used to calculate additional uncertainty estimates.

Apart from uncertainties in the $CRF_{HC20}$ value which is relevant for ecotoxicological characterizations, uncertainty is also attached to the output from all steps in the LCIA, including the models used to estimate chemical fate and chemical exposure. Fate models have recently been investigated for uncertainties by @nemecek2022operationalising, and uncertainty distributions for human toxicity impacts have been reported by @aurisano_probabilistic_2023, while other parameters connected to exposure of chemicals, cocktail effects, chemical application methodology still needs to be studied. Unfortunately, none of the current LCIA software have the possibility of including uncertainty of the ecotoxicological characterizations. As data on uncertainties becomes more available across several of the parameters included in LCIAs, we highly recommend LCIA software developers to allow for uncertainty estimations related to LCIA methodology to readily provide uncertainty estimates related to characterization factors.

# Conclusions  
We present an ecotoxicological modelling framework that fit a weighted nonlinear least squares model to species-specific effect data in order to assess the ecotoxicological effect factor, $CRF_{HC20}$, not only as a central value, but also including a standard deviation. We expand the modelling framework presented by @owsianiak_ecotoxicity_2023 to allow for the reporting probabilistic nature of the ecotoxicological effect factor. The suggested approach is applied to thousands of chemicals in a curated ecotoxicological database created specifically for this purpose, which opens up for exploring uncertainty of ecotoxicological effect factors for `r formNnum(nrow(nls_output_df %>% filter(status %in% c("Convergence","Convergence; Data insufficient"))))` chemicals. While the suggested approach is data-demanding and requires at least two toxicological records per species per chemical, it is still applicable to chemicals with fewer than 5 species-specific data per chemical, but uncertainty of the $CRF_{HC20}$-value increase significantly. Despite considerable efforts to compile a meaningful dataset, it is clear that the availability of reliable effect data remains limited, with only 30% of queried chemicals having sufficient ecotoxicological information. Even within the curated dataset, a significant portion of chemicals have sparse or insufficient data, rendering uncertainty estimation impossible. Data coverage and data reliability subsequently become competing interests for environmental assessment frameworks. However, given the magnitudes of uncertainty identified in our research, we advocate that only chemicals that are supported by enough empirical data to calculate uncertainty estimates should used. This is especially relevant for pesticides that are purposefully designed to be more toxic to specific species groups and where experiments generally are biased to target species groups. While challenges concerning data scarcity persist, the use of the current model to estimate probabilistic uncertainty provides a valuable framework for future research, and it may even provide a motivation to increase data collection efforts, also for chemicals for which some data is already available.  

## Future work  
Several ideas are queued for further investigations based on the present dataset. For example, how much does the endpoint conversions ($EC_x$ into $EC10^{eq}$) using regression coefficients affect the final $CRF_{HC20}$ value? A robust methodology to include the variability of each endpoint conversion could elucidate how feasible such data conversion really are. Moreover, since data scarcity is an issue, we are commencing an investigation on the the potential to include quantitative structure-activity relationship models, investigate the reliability of these models and evaluate if this data is suitable albeit potentially large uncertainties. Finally, many LCA studies are published despite missing toxicological characterizations for some chemicals in the LCIA step, leading to potentially underestimated toxicological impacts. We aim to investigate the data gaps within a large set of agi-food LCA studies, hopefully filling these gaps and assessing the updated outcomes.  


**Acknowledgements**  
The authors want to thank Andreu Rico, PhD, for input and discussions on ecologically relevant effect criterion selection, and prof. Rachel Foster for comments to the manuscript. PJGH is partially funded by the FORMAS Inequality and the Biosphere Project (2020-00454), Ardevora Charitable Trust, Gordon and Betty Moore Foundation (GBMF11613, 5668.01, 5668.02), and Walton Family Foundation (grant 2017-693, 2018-1371). PJGH has undertaken this research as part of the CGIAR Research Initiative on Low-Emission Food Systems. This program is supported by contributors to the CGIAR Trust Fund. 


\newpage
### References
